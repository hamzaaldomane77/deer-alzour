# دليل نظام تسجيل الدخول

## نظرة عامة

تم تنفيذ نظام تسجيل الدخول الكامل الذي يوجه المستخدمين إلى لوحة التحكم المناسبة بناءً على دورهم.

## الميزات المنجزة

### 1. AuthContext
- إدارة حالة المستخدم المسجل دخوله
- تخزين الـ token في localStorage و cookies
- وظائف تسجيل الدخول والخروج

### 2. صفحة تسجيل الدخول المحدثة
- الاتصال بـ API الحقيقي: `http://127.0.0.1:8000/api/login`
- عرض رسائل الخطأ
- التوجيه التلقائي بناءً على دور المستخدم

### 3. التوجيه بناءً على الدور
- **المستخدم العادي (role: "user")** → `/user`
- **المدير (role: "admin")** → `/admin`

### 4. لوحات التحكم
- **لوحة تحكم المدير** (`/admin`): إحصائيات شاملة وإدارة النظام
- **لوحة تحكم المستخدم** (`/user`): إحصائيات شخصية وإجراءات المستخدم

### 5. الحماية
- middleware لحماية الصفحات المحمية
- التحقق من صحة المستخدم في كل صفحة
- إعادة التوجيه التلقائي للصفحات غير المصرح بها

## كيفية الاستخدام

### تسجيل الدخول كمدير
```json
{
  "email": "admin@example.com",
  "password": "password"
}
```
سيتم توجيهك إلى `/admin`

### تسجيل الدخول كمستخدم عادي
```json
{
  "email": "user@example.com", 
  "password": "password"
}
```
سيتم توجيهك إلى `/user`

## هيكل الملفات المحدثة

```
src/
├── contexts/
│   └── AuthContext.tsx          # إدارة حالة المصادقة
├── app/
│   ├── layout.tsx              # AuthProvider wrapper
│   ├── login/
│   │   └── page.tsx            # صفحة تسجيل الدخول المحدثة
│   ├── admin/
│   │   └── page.tsx            # لوحة تحكم المدير
│   └── user/
│       └── page.tsx            # لوحة تحكم المستخدم
└── middleware.ts               # حماية الصفحات
```

## الاستجابة المتوقعة من API

### للمستخدم العادي
```json
{
  "message": "Login successful",
  "user": {
    "id": 2,
    "name": "مستخدم عادي",
    "email": "user@example.com",
    "role": "user"
  },
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
}
```

### للمدير
```json
{
  "message": "Login successful", 
  "user": {
    "id": 1,
    "name": "المدير العام",
    "email": "admin@example.com",
    "role": "admin"
  },
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
}
```

## الميزات الأمنية

1. **تخزين آمن للـ token**: في localStorage و cookies
2. **حماية الصفحات**: middleware يمنع الوصول غير المصرح به
3. **التحقق من الدور**: كل صفحة تتحقق من صلاحيات المستخدم
4. **تسجيل الخروج الآمن**: حذف جميع البيانات المحفوظة

## نظام Toast للإشعارات

تم إضافة نظام Toast متقدم لإظهار الإشعارات:

### أنواع Toast المتاحة:
- **success** ✅: للعمليات الناجحة
- **error** ❌: للأخطاء
- **warning** ⚠️: للتحذيرات
- **info** ℹ️: للمعلومات العامة

### أمثلة على الاستخدام:

#### Toast ترحيبي بعد تسجيل الدخول:
```javascript
showToast({
  type: 'success',
  title: `مرحباً ${user.name}!`,
  message: 'تم تسجيل دخولك كمدير بنجاح',
  duration: 4000
});
```

#### Toast عند تسجيل الخروج:
```javascript
showToast({
  type: 'info',
  title: 'تم تسجيل الخروج',
  message: `وداعاً ${user.name}، نراك قريباً!`,
  duration: 3000
});
```

#### Toast للأخطاء:
```javascript
showToast({
  type: 'error',
  title: 'خطأ في تسجيل الدخول',
  message: 'فشل في تسجيل الدخول. يرجى التحقق من البيانات المدخلة.',
  duration: 5000
});
```

## ملاحظات مهمة

- النظام يدعم اللغة العربية بالكامل
- التصميم متجاوب مع جميع الأجهزة
- الرسوم المتحركة محسنة لتجربة مستخدم أفضل
- جميع الصفحات محمية وتتطلب تسجيل دخول صالح
