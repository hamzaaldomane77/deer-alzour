# وثائق نظام إدارة الفروع (Branches)

## نظرة عامة

تم إنشاء نظام كامل لإدارة فروع الأمن الداخلي في لوحة تحكم الأدمن، بنفس تصميم صفحة الإنجازات.

## الملفات المنشأة

### 1. Types (الأنواع)
- **المسار:** `src/types/branch.ts`
- **الوصف:** يحتوي على جميع الأنواع المستخدمة في نظام الفروع
- **الأنواع:**
  - `Branch`: نوع الفرع الكامل
  - `BranchFormData`: بيانات النموذج
  - `BranchesResponse`: استجابة قائمة الفروع من API
  - `BranchResponse`: استجابة فرع واحد من API
  - `CreateBranchRequest`: طلب إنشاء فرع جديد
  - `UpdateBranchRequest`: طلب تحديث فرع

### 2. Services (الخدمات)
- **المسار:** `src/services/branchService.ts`
- **الوصف:** خدمة التعامل مع API الفروع
- **الدوال:**
  - `getBranches()`: جلب جميع الفروع
  - `getBranch(id)`: جلب فرع محدد
  - `createBranch(data)`: إنشاء فرع جديد
  - `updateBranch(id, data)`: تحديث فرع
  - `deleteBranch(id)`: حذف فرع

### 3. الصفحات

#### أ. صفحة قائمة الفروع
- **المسار:** `src/app/admin/branches/page.tsx`
- **الوظائف:**
  - عرض جميع الفروع في جدول
  - زر إضافة فرع جديد
  - أزرار عرض/تعديل/حذف لكل فرع
  - تصميم متجاوب (Desktop & Mobile)
  - تأكيد قبل الحذف

#### ب. صفحة إضافة فرع جديد
- **المسار:** `src/app/admin/branches/new/page.tsx`
- **الحقول:**
  - اسم الفرع بالعربية (مطلوب)
  - اسم الفرع بالإنجليزية (مطلوب)
  - اسم المسؤول (اختياري)

#### ج. صفحة عرض تفاصيل الفرع
- **المسار:** `src/app/admin/branches/[id]/page.tsx`
- **المعلومات المعروضة:**
  - الاسم بالعربية والإنجليزية
  - اسم المسؤول
  - معرف الفرع
  - تاريخ الإنشاء
  - تاريخ آخر تحديث
- **الأزرار:**
  - تعديل الفرع
  - حذف الفرع
  - العودة للقائمة

#### د. صفحة تعديل الفرع
- **المسار:** `src/app/admin/branches/[id]/edit/page.tsx`
- **الوظائف:**
  - تحميل البيانات الحالية
  - تعديل جميع الحقول
  - حفظ التعديلات

## واجهة API المستخدمة

### Endpoint الأساسي
```
http://127.0.0.1:8000/api/admin/branches
```

### الطلبات (Requests)

#### 1. جلب جميع الفروع
```http
GET /api/admin/branches
```

**الاستجابة:**
```json
{
  "status": "success",
  "branches": [
    {
      "id": 1,
      "name": "قيادة الأمن الداخلي",
      "boss": "قيادة الأمن الداخلي",
      "trName": "Internal Security Command",
      "created_at": "2025-11-09T15:10:56.000000Z",
      "updated_at": "2025-11-09T15:10:56.000000Z"
    }
  ]
}
```

#### 2. جلب فرع محدد
```http
GET /api/admin/branches/{id}
```

#### 3. إنشاء فرع جديد
```http
POST /api/admin/branches
Content-Type: application/json

{
  "name": "فرع القوى البشرية",
  "boss": "",
  "trName": "Human Resources Branch"
}
```

#### 4. تحديث فرع
```http
PUT /api/admin/branches/{id}
Content-Type: application/json

{
  "name": "فرع القوى البشرية",
  "boss": "اسم المسؤول",
  "trName": "Human Resources Branch"
}
```

#### 5. حذف فرع
```http
DELETE /api/admin/branches/{id}
```

## مميزات التصميم

### 1. التصميم المتجاوب
- جدول للشاشات الكبيرة
- بطاقات (Cards) للشاشات الصغيرة

### 2. الألوان والأنيميشن
- خلفية شفافة مع blur effect
- تأثيرات hover و motion من Framer Motion
- ألوان متناسقة مع بقية التطبيق

### 3. التحقق والأمان
- التحقق من صلاحيات الأدمن فقط
- رسائل تأكيد قبل الحذف
- معالجة الأخطاء ورسائل Toast

### 4. اللغة العربية
- جميع النصوص بالعربية
- دعم RTL
- تنسيق التواريخ بالعربية

## كيفية الاستخدام

### للأدمن:
1. تسجيل الدخول بحساب أدمن
2. الانتقال إلى `/admin/branches`
3. يمكنك:
   - عرض جميع الفروع
   - إضافة فرع جديد
   - عرض تفاصيل أي فرع
   - تعديل أي فرع
   - حذف أي فرع

### الروابط:
- **القائمة الرئيسية:** `/admin/branches`
- **إضافة جديد:** `/admin/branches/new`
- **عرض التفاصيل:** `/admin/branches/[id]`
- **التعديل:** `/admin/branches/[id]/edit`

## الملاحظات

1. **الصلاحيات:** الوصول محصور فقط للمستخدمين ذوي صلاحية `admin`
2. **الحقول المطلوبة:** الاسم بالعربية والإنجليزية فقط
3. **الحقول الاختيارية:** اسم المسؤول
4. **التوجيه التلقائي:** 
   - المستخدمين العاديين يتم توجيههم إلى `/user`
   - غير المسجلين يتم توجيههم إلى `/login`

## التكامل مع النظام

النظام يستخدم:
- ✅ AuthContext للتحقق من المصادقة
- ✅ Toast للإشعارات
- ✅ ConfirmDialog للتأكيد قبل الحذف
- ✅ Framer Motion للرسوم المتحركة
- ✅ apiClient من `lib/api.ts` للاتصال بالـ API

## الحالات الخاصة

### 1. عدم وجود فروع
- يتم عرض رسالة ودية مع أيقونة
- زر لإضافة أول فرع

### 2. فرع غير موجود
- رسالة خطأ واضحة
- زر للعودة للقائمة

### 3. فشل تحميل البيانات
- رسالة Toast بالخطأ
- توجيه تلقائي للصفحة المناسبة

---

تم إنشاء هذا النظام بتاريخ: 16 نوفمبر 2025

